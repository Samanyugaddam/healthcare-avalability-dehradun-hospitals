<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0"> -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <title>Web_GIS</title>
      <!-- Leaflet CSS/js -->
      <link rel="stylesheet" type="text/css" href="lib/leaflet/leaflet.css">
      <link rel="stylesheet" type="text/css" href="leaflet-routing-machine.css">
    <!-- CSS only -->
    <link href="./static/libs/bootstrap-5.1.3-dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=Promise"></script>
    <script type="text/javascript" src="lib/leaflet/leaflet.js"></script>
    <script type="text/javascript" src="leaflet-routing-machine.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-routing-machine/0.0"></script>


    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css" />
   
<script src="./static/libs/bootstrap-5.1.3-dist/js/bootstrap.bundle.min.js"></script>

    <script src="./static/libs/jquery.js"></script>

    <script src="https://unpkg.com/leaflet"></script>
   


<!-- 
<link rel="stylesheet" href=".\libs\leaflet-draw\leaflet.draw.css"/>
    <script src=".\libs\leaflet-draw\Leaflet.draw.js"></script> -->
    <!-- leaflet draw -->
    <!--  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" /> -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet.locatecontrol/dist/L.Control.Locate.min.css">

    <link rel="stylesheet" href="./static/libs/L.switchBasemap.css">
    <script src="./static/libs/L.switchBasemap.js"></script>

    <link rel="stylesheet" href="./static/libs/leaflet.css" />
    <script src="./static/libs/leaflet.js"></script>

    <script src="./static/libs/L.Control.ZoomBar-master/src/L.Control.ZoomBar.js"></script>
    <link rel="stylesheet" href="./static/libs/L.Control.ZoomBar-master/src/L.Control.ZoomBar.css" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

    <script src="./static/libs/Leaflet.zoomslider-master/src/L.Control.Zoomslider.js"></script>
    <link rel="stylesheet" href="./static/libs/Leaflet.zoomslider-master/src/L.Control.Zoomslider.css" />


    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="./static/libs/Leaflet.MousePosition-master/src/L.Control.MousePosition.js"></script>
    <link rel="stylesheet" href="./static/libs/Leaflet.MousePosition-master/src/L.Control.MousePosition.css" />

    <script
    src="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol@0.74.0/dist/L.Control.Locate.min.js"
    charset="utf-8"
  ></script>


    <!-- leaflet draw -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/0.4.2/leaflet.draw.css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/0.4.2/leaflet.draw.js"></script>

     <script src="./static/libs/L.Control.Appearance.js"></script>
     <script src="./static/libs/leaflet-hash.js"></script>

    

    <link rel="stylesheet" href="./static/libs/geocoder.css" />
    <script src="./static/libs/geocoder.js"></script>

    <script src="./static/libs/leaflet-side-by-side.min.js"></script>

    <script src="./static/libs/leaflet-search.js"></script>
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <script src="https://unpkg.com/file-saver"></script>
    <script src="https://unpkg.com/leaflet-search@2.9.9/dist/leaflet-search.min.js"></script>

     <!-- Add Bootstrap JS and jQuery scripts here -->
     <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
     <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
     <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
 

    <!-- <script src="./lib/Leaflet.SelectAreaFeature.js"></script>

    <script src=""></script> -->

    <!-- <link rel="stylesheet" href="libs/polyline-measure/line-measure.css" />
    <script src="libs/polyline-measure/line-measure.js"></script> -->

    <script src="./static/libs/leaflet.browser.print.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>



    <link rel="stylesheet" href="./static/libs/leaflet-measure-master/leaflet-measure.css" />
    <script src="./static/libs/leaflet-measure-master/leaflet-measure.js"></script>

    <script src="./static/libs/feat.js"></script>
	    <script src="https://kartena.github.io/Proj4Leaflet/lib/proj4-compressed.js"></script>
	    <script src="https://kartena.github.io/Proj4Leaflet/src/proj4leaflet.js"></script>



	<link rel="stylesheet" href="./static/libs/jquery-ui-1.12.1/jquery-ui.css">
    <script src="./static/libs/jquery-ui-1.12.1/external/jquery/jquery.js"></script>
    <script src="./static/libs/jquery-ui-1.12.1/jquery-ui.js"></script>
	
	<link rel="stylesheet" type="text/css" href="./static/styles.css">
    
    
</head>

<body>

   

    <div class="container-fluid h-100">
        <div class="row h-100">

            <!-- Left Container (30% width) -->

           


<div class="col-9">

    <div id="map" class="map">

    
        

        <!-- Map coordinate  -->
        <div class="leaflet-control map-coordinate">
            <div class="coordinate"></div>
        </div>

        <div id="bufferContent"></div>

        <div id="routingWindow" onmousedown="startDrag(event)">
            <span class="closeButton" onclick="closeRoutingWindow()">X</span>
            <p>Routing Window</p>
            <label for="startLat">Start Latitude:</label>
            <input type="text" id="startLat" placeholder="Enter start latitude">
    
            <label for="startLng">Start Longitude:</label>
            <input type="text" id="startLng" placeholder="Enter start longitude">
    
            <label for="destLat">Destination Latitude:</label>
            <input type="text" id="destLat" placeholder="Enter destination latitude">
    
            <label for="destLng">Destination Longitude:</label>
            <input type="text" id="destLng" placeholder="Enter destination longitude">
    
            <button onclick="initiateRouting()">Initiate Routing</button>
            <button onclick="removeRouting()">Remove Routing</button>
        </div>

        

        



        <div class="col-3 bg-light p-0" style="background-color: rgb(247, 247, 250);">
            <div class="d-flex flex-column">
                <!-- <button onclick="wms_layers()" type="button" id="wms_layers_btn" class="btn btn-danger btn-sm">Available WMS Layers</button> -->
                <button onclick="clear_all()" type="button" id="clear_btn" class="btn btn-warning btn-sm">Clear</button>
                <button onclick="show_hide_querypanel()" type="button" id="query_panel_btn" class="btn btn-secondary btn-sm">☰ Open Query Panel</button>
                <div id="legend"></div>
                <button onclick="show_hide_legend()" type="button" id="legend_btn" class="btn-integrated">☰ Show Legend</button>
                <button onclick="info()" type="button" id="info_btn" class="btn btn-secondary btn-sm">☰ Activate GetInfo</button>
                <!-- <button onclick="toggleSwipe()" type="button" id="button_swipe" class="btn btn-danger btn-sm">☰ Swipe</button> -->
                
            </div>
        </div>

                    
        <!-- full browser  -->
        <div class="leaflet-control full-screen" onclick=fullScreenView()>
            <svg width="1.5em" height="1.5em" viewBox="0 0 16 16" class="bi bi-arrows-fullscreen" fill="currentColor"
                xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd"
                    d="M5.828 10.172a.5.5 0 0 0-.707 0l-4.096 4.096V11.5a.5.5 0 0 0-1 0v3.975a.5.5 0 0 0 .5.5H4.5a.5.5 0 0 0 0-1H1.732l4.096-4.096a.5.5 0 0 0 0-.707zm4.344 0a.5.5 0 0 1 .707 0l4.096 4.096V11.5a.5.5 0 1 1 1 0v3.975a.5.5 0 0 1-.5.5H11.5a.5.5 0 0 1 0-1h2.768l-4.096-4.096a.5.5 0 0 1 0-.707zm0-4.344a.5.5 0 0 0 .707 0l4.096-4.096V4.5a.5.5 0 1 0 1 0V.525a.5.5 0 0 0-.5-.5H11.5a.5.5 0 0 0 0 1h2.768l-4.096 4.096a.5.5 0 0 0 0 .707zm-4.344 0a.5.5 0 0 1-.707 0L1.025 1.732V4.5a.5.5 0 0 1-1 0V.525a.5.5 0 0 1 .5-.5H4.5a.5.5 0 0 1 0 1H1.732l4.096 4.096a.5.5 0 0 1 0 .707z" />
            </svg>
        </div>
    </div>

   

    <div id="query_tab">
        <nav>
            <div class="nav nav-tabs" id="nav-tab" role="tablist" style="font-size:14px;">
                
                <button class="nav-link active" id="nav-attributes-tab" data-bs-toggle="tab" data-bs-target="#nav-attributes" type="button" role="tab" aria-controls="nav-attributes" aria-selected="true">Select by Attributes</button>
            <button class="nav-link" id="nav-draw-tab" data-bs-toggle="tab" data-bs-target="#nav-draw" type="button" role="tab" aria-controls="nav-draw" aria-selected="false">  Features

            </button>
           
            

        </div>
        </nav>
        
       <div class="tab-content" id="nav-tabContent" style="border: 2px solid white; padding: 10px"> 
            <div class="tab-pane fade show active" id="nav-attributes" role="tabpanel" aria-labelledby="nav-attributes-tab">
                <label for="layer"><b>Select Layer</b></label>
                <select id="layer" class="form-select form-select-sm" aria-label=".form-select-sm example">
                    <option selected>Select Layer</option>
                </select>
                <br>
                <label for="attributes"><b>Select Attribute</b></label>
                <select id="attributes" class="form-select form-select-sm" aria-label=".form-select-sm example">
                    <option selected>Select Attribute</option>
                </select>
                <br>
                <label for="operator"><b>Select Attribute</b></label>
                <select id="operator" class="form-select form-select-sm" aria-label=".form-select-sm example">
                    <option selected>Select Operator</option>
                </select>
                <br>
                <label for="value">Enter Value</label>
                <input type="text" class="form-control form-select-sm" id="value" name="value">
                <br>
                <button onclick="query()" type="button" class="btn btn-danger btn-sm">Load Layer</button>
                <button id="exportButton" type="button" class="btn btn-danger btn-sm">Export to Excel</button>

                

            </div> 
            
            
            <div class="tab-pane fade" id="nav-draw" role="tabpanel" aria-labelledby="nav-draw-tab">
                <!-- <label for="layer1"><b>Select Layer</b></label> -->
                <!-- <select id="layer1" class="form-select form-select-sm" aria-label=".form-select-sm example">
                    <option selected>Select Layer</option>
                </select> -->
                <!-- <br>
                <label for="draw_type"><b>Select Geometry Type</b></label>
                <select id="draw_type" class="form-select form-select-sm" aria-label=".form-select-sm example">

                    <option value="select">Select Shape</option>
                    <option value="Square">Square</option>
                    <option value="Box">Box</option>
                    <option value="Polygon">Polygon</option>
                    <option value="Star">Star</option>
                    <option value="clear">Clear</option>



                </select> -->


               



                <!-- <div class="button-container"> -->
                    <!-- <button id="openMapButton">Open Map Interface</button> -->
                    <!-- <button id="routeButton" class="btn-integrated">Find Route</button> -->
                    <!-- <div>
                        <label for="startLat">Start Latitude:</label>
                        <input type="text" id="startLat" placeholder="Enter start latitude">
                
                        <label for="startLng">Start Longitude:</label>
                        <input type="text" id="startLng" placeholder="Enter start longitude">
                    </div>
                
                    <div>
                        <label for="destLat">Destination Latitude:</label>
                        <input type="text" id="destLat" placeholder="Enter destination latitude">
                
                        <label for="destLng">Destination Longitude:</label>
                        <input type="text" id="destLng" placeholder="Enter destination longitude">
                    </div>
                    <button onclick="removeRouting()">Remove Routing</button> -->
                    <button class=" btn-integrated" onclick="exportDrawnData(); document.getElementById('nav-draw-tab').click();">Export Drawn Data</button>
                    <!-- <button onclick="myFunction()"  id="button_swipe" class="btn  btn-integrated">☰ Swipe</button> -->
                    <button onclick="goToShortPage()" class="btn-integrated" >Go to Short Page</button>
                    
                    <button onclick="wms_layers()"  id="wms_layers_btn" class=" btn-integrated ">Available WMS Layers</button>
                    <button onclick="openRoutingWindow()" class=" btn-integrated">Routing Window</button>
                    

                    <button id="bufferQueryButton" class="btn-integrated">Buffer Query</button>

                    <!-- Draggable container -->
        <div id="draggableContainer" style="display: none;">
            <form id="draggableForm" method="POST" action="/">
                <div class="form-header" id="dragHeader">
                    <h1>Buffer Query</h1>
                </div>
                <div class="form-group">
                    <label for="selected_layer">Select a Layer:</label>
                    <select class="form-control" name="selected_layer" required>
                        {% for layer in layers %}
                            <option value="{{ layer }}">{{ layer }}</option>
                        {% endfor %}
                    </select>
                </div>
    
                <div class="form-group">
                    <label for="new_table_name">New Table Name:</label>
                    <input type="text" class="form-control" name="new_table_name" required>
                </div>
    
                <div class="form-group">
                    <label for="buffer_radius">Buffer Radius:</label>
                    <input type="number" class="form-control" name="buffer_radius" step="0.1" required>
                </div>
    
                <button type="submit" class="btn btn-success">Add to Map</button>
            </form>
        </div>
        

                    
                    
                    <!-- <button onclick="redirectTobuffer()" class="btn-integrated">Buffer Query</button> -->
                    <!-- <button onclick="executeScript()">Execute Script</button> -->
                    


                    <div class="box">
                        <label for="layer"><b>Select GeoJson Layer</b></label>
                    <input type="file" id="fileInput" class="bound" />
                    
                    <button onclick="loadFileOnMap()" class="btn-integrated">Load File</button>
                    <!-- <button onclick="loadFileOnMap()" class="btn-integrated" >Load File</button> -->
                    <button onclick="removeGeoJSON()" class="btn-integrated">Remove GeoJSON</button>
                </div>


                <div class="box">
    <label for="layer"><b>Select CSV File</b></label>
                <input type="file" id="csvFileInput" accept=".csv" accept=".xlsx">
                <button id="loadDataButton" onclick="loadDataOnMap()" class="btn-integrated">Load Data</button>
                <button id="removeDataButton" onclick="removeData()" class="btn-integrated" >Remove Data</button>
              </div>

              
           
             
                
                
                
                </div>
                


            </div>

        </div>

    </div>

    <div id="table_data"></div>
    <!-- Scrollable modal -->

    <div class="modal fade" id="wms_layers_window" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable" id="movableDialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="staticBackdropLabel">Available WMS Layers</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <table id="table_wms_layers" class="table table-hover">
                    </table>
                </div>
                <div class="modal-footer">
                    <button onclick="close_wms_window()" type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Close</button>
                    <button onclick="add_layer()" type="button" id="add_map_btn" class="btn btn-primary btn-sm">Add Layer to Map</button>
                </div>
            </div>
        </div>
    </div>   
</div>
    </div>
    </div>
  




    
    <!-- <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script> -->
    
    <script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>
  
    <script src="./static/swipe.js"></script>
    <!-- <script src="./static/main.js"></script> -->
    <script src="./static/map.js"></script>

    <!-- <script src="basemap.js"></script> -->



</body>

</html>